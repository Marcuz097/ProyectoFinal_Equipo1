{% extends "base.html" %}
{% load static %}  <!-- IMPORTANTE: Cargar la etiqueta 'static' -->
{% load widget_tweaks %}

{% block titulo %} 
    {% if form.instance.pk %}
        Editar Cita 
    {% else %}
        Nueva Cita
    {% endif %}
{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'core/css/CSS-personalizado/cita-form.css' %}">
{% endblock %}

{% block contenido %} 

    <div class="container mt-1 d-flex justify-content-center"> 
        <div class="card card-shadow-innovador">
            
            <div class="card-header card-header-navy text-white text-center">
                <h2 class="card-title">
                    <i class="bi bi-calendar-plus-fill me-2"></i>
                    {% if form.instance.pk %}
                        Editar Cita 
                    {% else %}
                        Registrar Nueva Cita
                    {% endif %}
                </h2>
            </div>
            
            <form method="post">
                <div class="card-body">
                    {% csrf_token %}
                    
                    {% for field in form %}
                        <p>
                            <label for="{{ field.id_for_label }}">
                                {% if field.name == 'paciente' %}
                                    <i class="bi bi-person-fill text-contrast-blue"></i> Paciente
                                {% elif field.name == 'medico' %}
                                    <i class="bi bi-person-badge-fill text-contrast-blue"></i> MÃ©dico
                                {% elif field.name == 'fecha_hora' %}
                                    <i class="bi bi-calendar-date-fill text-contrast-blue"></i> Fecha y Hora
                                {% elif field.name == 'motivo' %}
                                    <i class="bi bi-chat-dots-fill text-contrast-blue"></i> Motivo
                                {% elif field.name == 'estado' %}
                                    <i class="bi bi-activity text-contrast-blue"></i> Estado
                                {% endif %}
                            </label>
                            
                            {% if field.name == 'paciente' or field.name == 'medico' %}
                                {{ field.errors }}
                                <select name="{{ field.name }}" id="{{ field.id_for_label }}"
                                        class="form-select" 
                                        {% if field.field.required %}required{% endif %}>
                                    
                                    <option value="" {% if not field.value %}selected{% endif %} disabled>
                                        -- Seleccionar --
                                    </option>
                                    
                                    {% for obj in field.field.queryset %}
                                        <option value="{{ obj.pk }}" {% if field.value|stringformat:"s" == obj.pk|stringformat:"s" %}selected{% endif %}>
                                            {% if field.name == 'medico' %}Dr(a). {% endif %}{{ obj.usuario.first_name }} {{ obj.usuario.last_name }}
                                        </option>
                                    {% endfor %}
                                </select>
                            {% elif field.name == 'motivo' %}
                                {{ field.errors }}
                                <textarea name="{{ field.name }}" id="{{ field.id_for_label }}" 
                                        class="form-control" rows="2" 
                                        placeholder="Describa brevemente el motivo de la cita...">{{ field.value|default_if_none:'' }}</textarea>
                            {% else %}
                                {{ field.errors }}
                                {{ field }} 
                            {% endif %}
                            
                            {% if field.help_text %}<small class="form-text text-muted">{{ field.help_text }}</small>{% endif %}
                        </p>
                    {% endfor %}
                    
                </div>
                
                <div class="card-footer d-flex justify-content-center gap-4 py-3 bg-light">
                    <button type="submit" class="btn btn-principal">
                        <i class="bi bi-save-fill me-1"></i> Guardar
                    </button>
                    <a href="{% url 'gestion_citas:cita-list' %}" class="btn btn-secundario-outline">
                        <i class="bi bi-x-circle-fill me-1"></i> Cancelar
                    </a>
                </div>
            </form>
        </div>
    </div>
{% endblock %}
