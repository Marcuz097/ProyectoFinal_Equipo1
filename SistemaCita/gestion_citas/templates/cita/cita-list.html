{% extends "base.html" %}

{% block titulo %} Lista de Citas {% endblock %}

{% block contenido %} 
<style>
    /* ------------------------------------------------------------------
       PALETA Y ESTILOS GLOBALES
       ------------------------------------------------------------------ */
    .bg-navy {
        background-color: #002D62 !important; /* Azul Marino Principal */
    }
    .text-contrast-blue {
        color: #4A90E2 !important;
    }
    
    /* Estilo del Contenedor Principal */
    .container-list {
        padding-top: 2rem;
        padding-bottom: 3rem;
    }

    /* --- ENCABEZADO DINÁMICO SÓLIDO (Innovación) --- */
    .header-dynamic-block {
        background-color: white;
        border-left: 8px solid #002D62; /* Borde de color Azul Marino fuerte */
        padding: 1.5rem 2rem; 
        margin-bottom: 3rem !important; 
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08); /* Sombra para levantarlo */
    }
    .header-dynamic-block h1 {
        font-weight: 900; 
        font-size: 2rem;
        margin-bottom: 0; 
        color: #002D62;
    }
    /* ------------------------------------------------ */

    /* Estilo para la Tabla */
    .table-elegant {
        border-radius: 10px;
        overflow: hidden; 
        border: 1px solid #E0E0E0;
    }

    /* Encabezado de la Tabla */
    .table-elegant thead th {
        background-color: #002D62; /* Azul Marino */
        color: #fff;
        font-weight: 700; /* Más negrita para el encabezado */
        padding: 1rem 0.75rem;
        border: none;
        letter-spacing: 0.5px;
        vertical-align: middle;
    }
    
    /* Filas y Efecto Hover */
    .table-elegant tbody tr {
        transition: background-color 0.3s ease;
        vertical-align: middle;
    }
    .table-elegant tbody tr:hover {
        background-color: #E3F2FD !important; /* Azul muy claro al pasar el ratón */
    }
    
    /* Estilo de la Celda de Estado (Badges) */
    .status-badge {
        font-size: 0.85em;
        padding: 0.4em 0.8em;
        border-radius: 20px;
        font-weight: 600;
        min-width: 80px;
        display: inline-block;
        text-align: center;
        text-transform: uppercase;
    }
    .status-Pendiente { background-color: #FFC107; color: #333; }
    .status-Confirmada { background-color: #28A745; color: #fff; }
    .status-Cancelada { background-color: #DC3545; color: #fff; }

    /* Botón Nueva Cita (Principal) */
    .btn-main-action {
        background-color: #002D62; /* Azul Marino Principal */
        border: none;
        color: white; 
        padding: 0.75rem 2rem; /* Más grande y elegante */
        font-weight: 600;
        border-radius: 50px;
        transition: background-color 0.2s;
        box-shadow: 0 4px 8px rgba(74, 144, 226, 0.3);
    }
    .btn-main-action:hover {
        background-color: #004080; 
        color: white; 
    }

    /* Botones de Acción de la Tabla (Consistencia) */
    .btn-action-edit {
        background-color: #4A90E2;
        border-color: #4A90E2;
        color: white;
        transition: background-color 0.2s;
    }
    .btn-action-edit:hover {
        background-color: #007bff;
        border-color: #007bff;
        color: white;
    }
    .btn-action-delete {
        background-color: #DC3545;
        border-color: #DC3545;
        color: white;
        transition: background-color 0.2s;
    }
    .btn-action-delete:hover {
        background-color: #C82333;
        border-color: #C82333;
        color: white;
    }
    .btn-action-group a {
        margin-right: 0.25rem;
    }
</style>

<div class="container container-list">
    
    <div class="header-dynamic-block d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
        
        <h1 class="title-elegant">
            <i class="bi bi-calendar-check-fill me-2 text-contrast-blue"></i> 
            Lista de Citas
        </h1>
        
        <a href="{% url 'gestion_citas:cita-create' %}" class="btn btn-main-action">
            <i class="bi bi-plus-circle-fill me-1"></i> Nueva Cita
        </a>
    </div>
    
    {% if citas %}
    <div class="table-responsive shadow-lg table-elegant">
        <table class="table table-striped table-hover mb-0">
            <thead>
                <tr>
                    <th><i class="bi bi-hash"></i> ID</th> 
                    <th><i class="bi bi-clock-fill"></i> Fecha y Hora</th>
                    <th><i class="bi bi-chat-dots-fill"></i> Motivo</th>
                    <th><i class="bi bi-activity"></i> Estado</th>
                    <th><i class="bi bi-person-fill"></i> Paciente</th>
                    <th><i class="bi bi-person-badge-fill"></i> Médico</th>
                    <th><i class="bi bi-journal-medical"></i> Especialidad(es)</th>
                    <th><i class="bi bi-gear-fill"></i> Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for cita in citas %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ cita.fecha_hora|date:"d/m/Y H:i" }}</td>
                    <td>{{ cita.motivo }}</td>
                    
                    <td>
                        {% if cita.estado == 'Pendiente' %}
                            <span class="status-badge status-Pendiente">Pendiente</span>
                        {% elif cita.estado == 'Confirmada' %}
                            <span class="status-badge status-Confirmada">Confirmada</span>
                        {% elif cita.estado == 'Cancelada' %}
                            <span class="status-badge status-Cancelada">Cancelada</span>
                        {% else %}
                            <span class="status-badge">{{ cita.estado }}</span>
                        {% endif %}
                    </td>
                    
                    <td>{{ cita.paciente.usuario.first_name }} {{ cita.paciente.usuario.last_name }}</td>
                    <td>{{ cita.medico.usuario.first_name }} {{ cita.medico.usuario.last_name }}</td>
                    <td>
                        {% for esp in cita.medico.especialidades.all %}
                            {{ esp.nombre }}{% if not forloop.last %}, {% endif %}
                        {% empty %}
                            <span class="text-muted small">N/A</span>
                        {% endfor %}
                    </td>
                    
                    <td class="btn-action-group">
                        <a href="{% url 'gestion_citas:cita-update' pk=cita.pk %}" class="btn btn-sm btn-action-edit">
                            <i class="bi bi-pencil-fill"></i>
                        </a>
                        <a href="{% url 'gestion_citas:cita-delete' pk=cita.pk %}" class="btn btn-sm btn-action-delete">
                            <i class="bi bi-trash-fill"></i>
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="alert alert-warning shadow-sm mt-4 p-4 text-center">
        <h4 class="alert-heading"><i class="bi bi-info-circle-fill me-2"></i> No hay citas registradas</h4>
        <p class="mb-0">Utiliza el botón "Nueva Cita" para comenzar a agendar.</p>
    </div>
    {% endif %}
</div>
{% endblock %}