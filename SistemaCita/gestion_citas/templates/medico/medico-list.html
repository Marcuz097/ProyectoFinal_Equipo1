{% extends "base.html" %}
<!-- Hereda la estructura y bloques definidos en 'base.html' (cabecera, pie, layout global) -->

{% load static %}
<!-- Carga la etiqueta 'static' para poder referenciar archivos estáticos (CSS, imágenes, etc.) -->

{% block titulo %} Lista de Médicos {% endblock %}
<!-- Define el texto que irá en el bloque 'titulo' (se mostrará en la pestaña del navegador) -->

{% block extra_css %}
<link rel="stylesheet" href="{% static 'core/css/CSS-personalizado/medico-list.css' %}">
<!-- Incluye la hoja de estilo específica para la vista de lista de médicos -->
{% endblock %}

{% block contenido %}
<!-- Inicio del bloque principal de contenido -->

<div class="container py-4">
    <!-- Contenedor principal con padding vertical -->

    <div
        class="header-dynamic-block d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4">
        <!-- Encabezado adaptable que contiene título y acciones (responsive) -->

        <h1 class="text-deep-navy">
            <!-- Título principal -->
            <i class="bi bi-person-badge-fill me-3 text-contrast-blue"></i>
            <!-- Ícono decorativo antes del título -->
            Lista de Médicos
        </h1>

        <div class="d-flex gap-3 mt-3 mt-md-0">
            <!-- Contenedor de botones de acción (se separan con gap-3) -->

            <a href="{% url 'gestion_citas:medico-create' %}"
                class="btn btn-main-action text-white shadow-sm rounded-pill"
                title="Asignar perfil médico a un usuario ya registrado.">
                <!-- Botón para asignar perfil médico a un usuario existente -->
                <i class="bi bi-person-plus-fill me-2"></i> Asignar Perfil Médico
            </a>

            <a href="{% url 'registrar_medico' %}" class="btn btn-secondary-action shadow-sm rounded-pill"
                title="Crear una nueva cuenta de usuario antes de registrarlo como médico.">
                <!-- Botón para crear un nuevo usuario (preparación antes de asignar como médico) -->
                <i class="bi bi-person-fill-add me-2"></i> Crear Nuevo Usuario
            </a>
        </div>
    </div>

    <div class="row filter-container">
        <!-- Fila que contiene el campo de búsqueda / filtro -->
        <div class="col-12 col-md-8 col-lg-6 mx-auto">
            <div class="search-input-wrapper">
                <!-- Wrapper del input con icono -->
                <input type="text" id="filtro" class="form-control"
                    placeholder="Buscar médicos por nombre, matrícula o especialidad...">
                <!-- Campo de texto para filtrar tarjetas en client-side -->
                <i class="bi bi-search"></i>
                <!-- Icono de búsqueda decorativo -->
            </div>
        </div>
    </div>
    {% if medicos %}
    <!-- Si existe al menos un médico, muestra el grid de tarjetas -->

    <div class="row g-4">
        <!-- Grid responsivo con gap entre tarjetas -->
        {% for medico in medicos %}
        <!-- Iteración sobre la lista de médicos provista por la vista -->
        <div class="col-12 col-sm-6 col-lg-4">
            <!-- Columna responsiva para cada tarjeta -->
            <div class="card h-100 medico-widget-compact filtro-item">
                <!-- Tarjeta de médico; tiene la clase 'filtro-item' para el filtrado JS -->

                <div class="medico-name-header-final">
                    <!-- Encabezado de la tarjeta con nombre -->
                    <i class="bi bi-person-square"></i>
                    <h5 class="text-truncate"
                        title="Dr(a). {{ medico.usuario.first_name }} {{ medico.usuario.last_name }}">
                        <!-- Muestra el nombre del médico, con tooltip completo si se trunca -->
                        Dr(a). {{ medico.usuario.first_name }} {{ medico.usuario.last_name }}
                    </h5>
                </div>

                <div class="medico-id-strip">
                    <!-- Banda que muestra un ID visual (contador del loop) -->
                    ID de Médico: <strong>{{ forloop.counter }}</strong>
                </div>

                <div class="medico-card-body-details bg-white">
                    <!-- Cuerpo de la tarjeta con detalles importantes -->

                    <div>
                        <span class="label-icon">
                            <i class="bi bi-credit-card-2-front-fill"></i> Matrícula
                        </span>
                        <span class="value-normal">{{ medico.matricula }}</span>
                        <!-- Muestra la matrícula profesional del médico -->
                    </div>

                    <div>
                        <span class="label-icon">
                            <i class="bi bi-heart-pulse-fill"></i> Especialidad(es)
                        </span>
                        <span class="value-normal"
                            title="{% for esp in medico.especialidades.all %}{{ esp.nombre }}{% if not forloop.last %}, {% endif %}{% endfor %}">
                            <!-- Muestra visual de las especialidades; el title contiene la lista completa -->
                            {% for esp in medico.especialidades.all %}
                            {{ esp.nombre }}{% if not forloop.last %}, {% endif %}
                            {% empty %}
                            Sin asignar
                            {% endfor %}
                        </span>
                    </div>

                    <div>
                        <span class="label-icon">
                            <i class="bi bi-telephone-fill"></i> Teléfono
                        </span>
                        <span class="value-normal">{{ medico.telefono|default:"N/A" }}</span>
                        <!-- Muestra teléfono o 'N/A' si no está definido -->
                    </div>

                    <div>
                        <span class="label-icon">
                            <i class="bi bi-envelope-fill"></i> Email
                        </span>
                        <span class="value-normal" title="{{ medico.usuario.email|default:'N/A' }}">
                            <!-- Si existe email, lo envuelve en un mailto; si no, muestra N/A -->
                            {% if medico.usuario.email %}
                            <a href="mailto:{{ medico.usuario.email }}" class="text-decoration-none text-dark">
                                {{ medico.usuario.email }}
                            </a>
                            {% else %}
                            N/A
                            {% endif %}
                        </span>
                    </div>
                </div>

                <div class="widget-footer-actions">
                    <!-- Pie de la tarjeta con acciones editar / eliminar -->
                    <a href="{% url 'gestion_citas:medico-update' pk=medico.pk %}"
                        class="btn btn-outline-marine btn-action-wide" data-bs-toggle="tooltip" title="Editar detalles">
                        <!-- Enlace para editar datos del médico -->
                        <i class="bi bi-pencil-square"></i> Editar
                    </a>
                    <a href="{% url 'gestion_citas:medico-delete' pk=medico.pk %}"
                        class="btn btn-delete-outline-innovador btn-action-wide" data-bs-toggle="tooltip"
                        title="Eliminar médico">
                        <!-- Enlace para confirmar eliminación del médico -->
                        <i class="bi bi-trash"></i> Eliminar
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
        <!-- Fin del bucle de médicos -->
    </div>

    {% else %}
    <!-- Si no hay médicos, mostrar mensaje informativo y CTA -->
    <div class="alert alert-info text-center shadow-lg border-0 py-5" style="background-color: #e6f3ff;">
        <h4 class="alert-heading text-deep-navy">
            <i class="bi bi-emoji-frown me-3"></i> No se encontraron Médicos
        </h4>
        <p class="mb-0 text-secondary">Utiliza el botón <strong>"Asignar Perfil Médico"</strong> o <strong>"Crear Nuevo Usuario"</strong> para
            comenzar a registrar profesionales.</p>
        <a href="{% url 'gestion_citas:medico-create' %}" class="btn btn-main-action mt-3 rounded-pill">
            <!-- Botón para iniciar la creación/registro de médicos -->
            <i class="bi bi-person-plus-fill me-2"></i> Asignar Perfil Médico
        </a>
    </div>
    {% endif %}
</div>

<script>
    /* Script para filtrar tarjetas (cliente-side) según texto del input */
    document.addEventListener("DOMContentLoaded", function () {
        const input = document.getElementById("filtro"); // Campo de texto del filtro
        const items = document.querySelectorAll(".filtro-item"); // Elementos a filtrar (tarjetas de médico)

        input.addEventListener("input", function () {
            const texto = input.value.toLowerCase().trim(); // Obtiene el texto de búsqueda

            items.forEach(item => {
                const contenido = item.innerText.toLowerCase(); // Contenido completo de la tarjeta
                // Muestra el elemento si el contenido incluye el texto de búsqueda
                item.style.display = contenido.includes(texto) ? "" : "none";
            });
        });
    });
</script>
{% endblock contenido %}
<!-- Fin del bloque de contenido -->
